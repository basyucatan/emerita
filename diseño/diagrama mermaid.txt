---
config:
  layout: elk
---
erDiagram
    negocios ||--o{ users : gestiona
    negocios ||--o{ divisions : pertenece
    negocios ||--o{ empresas : registra
    deptos ||--o{ users : agrupa
    roles ||--o{ modelHasRoles : asigna
    users ||--o{ modelHasRoles : posee
    roles ||--o{ roleHasPermissions : contiene
    permissions ||--o{ roleHasPermissions : define
    empresas ||--o{ contactos : tiene
    empresas ||--o{ obras : contrata
    empresas ||--o{ compras : surte
    divisions ||--o{ clases : agrupa
    divisions ||--o{ cajas : dispone
    divisions ||--o{ bodegas : posee
    divisions ||--o{ obras : clasifica
    clases ||--o{ materials : categoriza
    marcas ||--o{ lineas : fabrica
    lineas ||--o{ materials : define
    unidads ||--o{ materials : mide
    cajas ||--o{ auditoriasCaja : inspeccionada
    cajas ||--o{ movimientosCaja : registra
    bodegas ||--o{ auditoriasStock : inspeccionada
    bodegas ||--o{ movimientosStock : registra
    auditoriasStock ||--o{ auditoriasStockDets : desglosa
    users ||--o{ compras : registra
    users ||--o{ ventas : genera
    compras ||--o{ comprasDets : incluye
    comprasDets }o--|| materials : referencia
    bodegas ||--o{ inventarios : resguarda
    materials ||--o{ inventarios : stock
    ventas ||--o{ ventasDets : desglosa
    obras ||--o{ ventas : genera

    negocios {
        int id
        string negocio
        string razonSocial
        string rfc
        string logotipo
    }

    users {
        int id
        int IdDepto
        int IdNegocio
        string name
        string email
        string telefono
        string password
        boolean activo
    }

    deptos {
        int id
        string depto
    }

    divisions {
        int id
        int IdNegocio
        string division
    }

    empresas {
        int id
        int IdNegocio
        string empresa
        string razonSocial
        string rfc
        string direccion
        boolean esCliente
        boolean esProveedor
    }

    contactos {
        int id
        int IdEmpresa
        string nombre
        string puesto
        string telefono
        string correo
    }

    materials {
        int id
        int IdClase
        int IdLinea
        int IdUnidad
        int IdTipo
        string referencia
        string material
        string foto
        decimal KgxMetro
        decimal rendimiento
        int IdUnidadRend
        json adicionales
    }

    obras {
        int id
        int IdEmpresa
        int IdDivision
        string obra
        string ubicacion
        string estatus
        date fechaInicio
    }

    compras {
        int id
        int IdEmpresa
        int IdObra
        int IdCaja
        int IdUser
        string tipoGasto
        decimal total
        string estatus
    }

    comprasDets {
        int id
        int IdCompra
        int IdMaterial
        decimal cantidad
        decimal costoU
        decimal importe
    }

    cajas {
        int id
        int IdDivision
        string caja
        decimal saldoActual
    }

    auditoriasCaja {
        int id
        int IdCaja
        int IdUser
        decimal saldoLibros
        decimal saldoFisico
        decimal diferencia
    }

    movimientosCaja {
        int id
        int IdCaja
        int IdUser
        string tipoMovimiento
        decimal importe
        int IdAuditoriaCaja
    }

    bodegas {
        int id
        int IdDivision
        string bodega
    }

    auditoriasStock {
        int id
        int IdBodega
        int IdUser
        datetime fechaHora
    }

    auditoriasStockDets {
        int id
        int IdAuditoriaStock
        int IdMaterial
        decimal stockLibros
        decimal stockFisico
        decimal diferencia
    }

    movimientosStock {
        int id
        int IdBodega
        int IdMaterial
        int IdUser
        string tipoMovimiento
        decimal cantidad
        int IdAuditoriaStock
    }

    ventas {
        int id
        int IdObra
        int IdUser
        decimal total
        string estatus
    }

    ventasDets {
        int id
        int IdVenta
        int IdMaterial
        decimal cantidad
        decimal precioVenta
        decimal importe
    }